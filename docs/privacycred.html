
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>1. PrivacyCred description &#8212; PrivacyCred 0.9 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to PrivacyCred’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>PrivacyConsent is a system that allows a citizen to manage informed consent to two independent entities to exchange personal data among them for a very specific purpose. PrivacyConsent is based on PrivacyCred, a generic credential system which is designed to be secure, privacy-preserving, scalable, performant and robust.</p>
<p>PrivacyCred is designed specifically for some important use cases where especially sensitive personal data is handled, like when people at risk of exclusion is involved or with some health data flows. A high degree of privacy and unlinkability is the first design criteria. It also supports scenarios where physical, on-person verification of identity of holder is needed and where normal W3C Verifiable Credential flows are not fully suitable as they are normally designed currently.</p>
<p>The document is structured as follows.</p>
<p>The first part describes the PrivacyCred system, including the data model, interfaces and main interactions.</p>
<p>The second part describes the PrivacyConsent flows on top of PrivacyCred for a very strict use case: managing the informed consent of a user in the collective of people at risk of exclusion.</p>
<div class="section" id="privacycred-description">
<h1><span class="section-number">1. </span>PrivacyCred description<a class="headerlink" href="#privacycred-description" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2><span class="section-number">1.1. </span>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The journey of a certificate is completed in 3 distinct steps:</p>
<ol class="arabic simple">
<li><p>the collection and registration of data about the citizen and her associated characteristics,</p></li>
<li><p>the issuance of certificate, and</p></li>
<li><p>the presentation of the certificate to a verifier for its verification.</p></li>
</ol>
<p>A certificate should rely on a minimum dataset. Included in the minimum dataset is a Unique Certificate Identifier (UCI), which could be used as a link to the underlying data registry.</p>
<p>The verifier of a certificate should be able to establish that:</p>
<ul class="simple">
<li><p>The certificate has been issued by an authorised entity;</p></li>
<li><p>The information presented on the certificate is authentic, valid, and has not been altered;</p></li>
<li><p>The certificate can be linked to the holder of the certificate;</p></li>
</ul>
<div class="section" id="main-design-principles-and-business-requirements">
<h3><span class="section-number">1.1.1. </span>Main design principles and business requirements<a class="headerlink" href="#main-design-principles-and-business-requirements" title="Permalink to this headline">¶</a></h3>
<p>The design of the trust framework for interoperable issuing of certificates and verification of their integrity and authenticity relies on key design principles listed below. The list is not prioritised. Instead, the trust framework that is specified later in the document attempts to optimise as many of the key design principles as possible.</p>
<dl>
<dt>Data protection (including data minimisation, purpose limitation, etc.)</dt><dd><p>The trust framework should protect the data of the involved individual stakeholders (most importantly, certificate holders). This covers several data protection dimensions catered by the General Data Protection Regulation, including purpose limitation and data minimisation. In practice, only the bare minimum set of data that is required for the supported use cases should be processed (data minimisation) and the purpose of data collection should be checked against the use cases (purpose limitation). Similarly, only the bare minimum set of data that is required for the supported use cases should be presented to a specific verifier (data minimisation) and the purpose of data presentation should be checked against the use cases (purpose limitation). In order to achieve the latter, the trust framework may support different presentation datasets for different verifier scenarios. The data protection principle has a strong impact on the specification of the Minimum Dataset and the design of the use cases of the trust framework.</p>
</dd>
<dt>Data security and privacy by design and by default</dt><dd><p>Abuse of data by actors (especially, the certificate verifiers and holders) and forgery should be prevented by any reasonable means. The trust framework should by design and default ensure the security and the privacy of data in the compliant implementations, ensuring both security and privacy. Available tools should be used for restricting access to data and preventing malicious use of data, while the establishing of the authenticity of data and its link to the certificate holder should be ensured. The design should prevent the collection of identifiers or other similar data which might be crossreferenced with other data and re-used for tracking (‘Unlinkability’).</p>
</dd>
<dt>Inclusiveness (especially medium-neutrality)</dt><dd><p>The trust framework should be inclusive especially towards the individual citizen (‘no citizen left behind’). The design of the trust framework should attempt to maximize its support for diverse contexts (e.g., high resource vs low resource contexts). To enable this, the trust framework should support a spectrum of certificate presentation media from plain paper certificate to augmented paper certificates (e.g., paper certificate with printed machinereadable parts such as barcodes, QR codes, Machine Readable Zones) and to purely digital certificates (e.g., in-app certificates).</p>
<p>The PrivacyCred system supports paper certificates, augmented paper certificates, QR codes and purely digital certificates.</p>
<p>In addition, contrary to many SSI Verifiable Credentials implementations, the PrivacyCred system is implemented as a PWA (Progressive Web App) that can be used simply in a mobile browser (or tablet/PC) without installing anything in the device or registering for anything.</p>
<p>However, the user can install the PWA in the device if the user so wishes to facilitate future uses. In any case, the system does not require any type of registration of the identity of the user.</p>
</dd>
<dt>Simplicity and user-friendliness</dt><dd><p>It is very important that the trust framework is designed with simplicity and user-friendliness of the possible implementation of digital certificate systems in mind. More formally, the trust framework should not have features or functionalities that would unnecessarily complicate the resulting implementation of a digital certificate system or make them unnecessarily difficult to use. Lack of simplicity could increase the time it takes to implement the compliant digital certificate systems, while lack of user friendliness could hinder the uptake of the resulting implementations. User-friendliness is relevant for quick and easy processing, specifically to certificate holders and to verifiers.</p>
<p>The PrivacyCred system follows the rule of <strong>Occam’s Razor</strong> eliminating any feature or functionality which is not strictly required for the use case.</p>
<p>This not only provides simplicity and user-friendlyness but also provides a system easier to understand and maintain which is more secure and robust.</p>
</dd>
<dt>Implementation flexibility</dt><dd><p>The trust framework specifications should provide implementers with a variety of options when developing digital certificate systems according to the trust framework specifications. This key design principle aims at reducing the implementation time and leveraging/reusing existing infrastructures in involved entities. To satisfy this principle, the trust framework specifies, whenever possible, a list of alternative methods, flows, architectures and implementation options, for example alternative presentation media, verification options, implementation technologies, etc. whilst still guaranteeing the same level of trustworthiness.</p>
</dd>
<dt>Modularity and scalability</dt><dd><p>This is strongly linked with the previous key design principle. The trust framework architecture should be modular and easily scalable, for instance, to additional usage scenarios, use cases and types of certificates. The trust framework already supports different usage scenarios (e.g. alternative settings in which certificates may be requested or verification may take place).</p>
</dd>
<dt>Open standards</dt><dd><p>The trust framework should rely for its implementations on open standards, to the extent that this is possible. This will greatly contribute to the interoperability of the resulting implementations, in addition combined with open governance and open source implementations, it will instil trust in the involved stakeholders.</p>
</dd>
<dt>Cross-border interoperability</dt><dd><p>Implementations of certificates that comply with the specifications of the trust framework should be interoperable, and not only at the national level. This means that if Countries A and B implement the specifications, it should be possible for a verifier in Country B to verify a digital vaccination certificate that has been issued in Country A.</p>
<p>Cross-border interoperability should be ensured across EU and EEA countries. The Trust Framework should not prevent interoperability with the solutions designed on a global level.</p>
</dd>
</dl>
</div>
<div class="section" id="id-binding-and-verification">
<h3><span class="section-number">1.1.2. </span>ID binding and verification<a class="headerlink" href="#id-binding-and-verification" title="Permalink to this headline">¶</a></h3>
<p>An important parameter of the trust framework pertains to the identity of the subject of the certificate i.e., the person for whom the certificate is issued. The identity of this subject shall be bound to a certificate when the latter is issued (ID binding) and has to be verified when the certificate is being presented and verified (ID verification). These two processes (ID binding at the Issuance step and ID verification at the Presentation and Verification step) prevent possible impersonation attempts (i.e., a person fraudulently presenting a certificate that has been issued to someone else as if it were their own), and are in line with the data security and privacy by design and default principles of the trust framework.</p>
<p>The processes of ID binding and/or verification shall rely on (nationally and/or internationally) established methods for ID binding and verification. In other words, the trust framework does not specify in its architecture dedicated components or modalities for undertaking the ID binding and verification process.</p>
<p>The recommended methods for performing ID binding and verification are based on nationally issued identity proof documents, such as national IDs and passports, and regulated customer onboarding processes (in the case of private companies). The binding is performed at the time of issuance (ID binding) and verification (ID verification) of the certificate and therein personally identifying information held in the syetems of the entities involved should be compared against the information in the certificate.</p>
<p>Contrary to many SSI Verifiable Credentials implementations, the PrivacyCred system does not require any registration on the part of the user like registering her DID in the blockchain or any other repository, as the system relies in pre-existing identification processes (e.g., KYC for private companies).</p>
<p>The only personal information managed by the system is the one in the minimum dataset as specified in this document.
The personal data elements are incorporated to the certificate and not used for any other thing or purpose.
It is assumed that the minimal person identification data specified in this document can be used to perform the ID binding with a national ID, passport or any other suitable nationally issued identity document.</p>
</div>
</div>
<div class="section" id="privacycred-general-description-of-the-system">
<h2><span class="section-number">1.2. </span>PrivacyCred: General description of the system<a class="headerlink" href="#privacycred-general-description-of-the-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="main-components">
<h3><span class="section-number">1.2.1. </span>Main components<a class="headerlink" href="#main-components" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id2">
<a class="reference internal image-reference" href="_images/SafeIsland_Components.png"><img alt="Components of the system" src="_images/SafeIsland_Components.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">Components of the system.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The main components are the following:</p>
<table class="colwidths-given docutils align-default" id="id3">
<caption><span class="caption-text">Main components</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Issuer Entity</strong></p></td>
<td><p>The juridical person that digitally signs and issues a credential to the User.
The Issuer Entity employs or subcontracts the actual people performing the process
called Issuer Operator in the diagram. The Issuer Entity assumes full responsibility for
the legal implications of the issueance process, especially GDPR compliance. The Issuer
Entity acts as a Data Controller with respect to the Personal Information collected from
the Citizen when the certification is issued.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Issuer Operator</strong></p></td>
<td><p>The natural person that is employed/subcontracted by the Issuer Entity to actually
drive the process of issuing the credential on behalf of the Issuer Entity.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Issuer Operator App</strong></p></td>
<td><p>This is the application used by the natural person that drives the issuance of
the credential. The application allows the operator to enter the details of the user
and of the credential and issues the credential to the user on behalf of the
Issuer Entity. It is the responsibility of the Issuer Entity to ensure that the
Operator performs the process in the right way.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Citizen</strong></p></td>
<td><p>This is the natural person that receives a credential and may present it when needed.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Citizen  WebApp</strong></p></td>
<td><p>This is the application used by the end user to manage the credentials.
The reference implementation is not a native application but rather a PWA
(Progressive Web App), which can be used either as a normal web app
(without installation) or it can be installed and used in a very similar way
to a native mobile app. The characteristics of this app are explained later.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Verifier Entity</strong></p></td>
<td><p>A juridical person that verifies the credential. In the process of verification, the
Verifier Entity receives personal data from the Citizen. The Verifier Entity is
responsible for compliance of all applicable regulations, including GDPR.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Verifier Operator</strong></p></td>
<td><p>A natural person that verifies the credential. It is important to distinguish between
natural and juridical persons in the verification process because the flows may be
different as the regulatory implications may be different. The diagram does not
explicitly mention the Verifier Person, but it will be described in detail later
in the document.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Verifier App</strong></p></td>
<td><p>The application used to verify the credential presented by the user. The reference
application can be used either by an employee of a Verifier Entity or by an individual
natural person, as explained later.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Public-Permissioned</strong>
<strong>blockchain network</strong></p></td>
<td><p>This is a general-purpose blockchain network which is used to implement the
Trust Framework allowing the efficient and secure verification of credentials.
It is never used to store personal information. Personal information management is
the responsibility of the legal entities Issuer Entity and Verifier Entity,
and they are responsible for compliance to applicable regulations, especially GDPR.
There may be more than one blockchain network, and the system is very interoperable
across networks. The specific interoperability features are describer in a specific
section later in this document.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="main-credential-flow">
<h3><span class="section-number">1.2.2. </span>Main credential flow<a class="headerlink" href="#main-credential-flow" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id4">
<a class="reference internal image-reference" href="_images/RapidTest_Architecture-Operation.png"><img alt="Main credential flow" src="_images/RapidTest_Architecture-Operation.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">Main credential flow.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<ol class="arabic">
<li><p><strong>Verification of User and Credential issuance</strong></p>
<p>The Issuer Operator identifies the User (in the same way as an airline employee identifies passengers before boarding a plane) and uses her mobile app to enter the details of the User. In the initial implementation of the system the operator has also to enter manually the details of the Credential to be issued. It is the responsibility of the Issuer Operator (and ultimately of the Issuer Entity) to ensure the veracity of both the User details and the Credential details. This is a critical point in the system, as the level of trust in the credentials will depend on the level of trust of the issuance process.</p>
</li>
<li><p><strong>Sending the Credential to the Citizen</strong></p>
<p>The Credential is sent to the User. There are several possible flows, using different channels (email, QR, etc.). The main one is using QR codes and is the following:</p>
<ol class="arabic simple">
<li><p>The Issuer Operator displays the credential for the User in her mobile phone screen, in a QR format. More detaisl about the specific QR format later.</p></li>
<li><p>The User scans the QR using her mobile web app.</p></li>
<li><p>The mobile web app of the User gets the Credential and stores it in the storage of the mobile device.</p></li>
</ol>
</li>
<li><p><strong>Store the Credential</strong></p>
<p>The Credential is stored in the mobile phone of the User. In the reference implementation it is stored in the IndexedDB local database. More than one credential can be stored in the mobile. A Citizen could for example store credentials of other persons of the family when traveling, or a history track of credentials received during a vacation. More details are given later in this document.</p>
</li>
<li><p><strong>Present the Credential</strong></p>
<p>When the Citizen has to prove something, she sends the Credential to the Verifier. As before, there are several possible flows, the main one using QR codes:</p>
<ol class="arabic simple">
<li><p>The User display the Credential in her mobile phone in QR format.</p></li>
<li><p>The Verifier scans the QR from the User mobile screen</p></li>
<li><p>The mobile app from the Verifier receives the Credential and verifies it.</p></li>
</ol>
</li>
<li><p><strong>Verify the Credential using the Trust Framework in the blockchain</strong></p>
<p>The Verifier mobile app verifies formally the Credential with the signature, and then checks that the signature of the Credential corresponds to an authorized Issuer Entity registered in the Trust Framework in the blockchain. The verification process is essentially the one described in the W3C VC specifications.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="the-trust-framework-bootstrapping-the-system">
<h2><span class="section-number">1.3. </span>The Trust Framework: bootstrapping the system<a class="headerlink" href="#the-trust-framework-bootstrapping-the-system" title="Permalink to this headline">¶</a></h2>
<p>Before the issuance of credentials can take place, the system has to be bootstrapped and setup. There are two processes that have to be performed:</p>
<ol class="arabic simple">
<li><p>A One-time process at the beginning of the whole system: involves things like deploying Smart Contracts and initializing them with the parameters of the system.</p></li>
<li><p>A process for the onboarding of each new Issuer Entity and Verifier Entity. This process is basically generating and registering in the blockchain the Identity of the entity entering the system.</p></li>
</ol>
<div class="section" id="public-permissioned-blockchain-network">
<h3><span class="section-number">1.3.1. </span>Public-Permissioned blockchain network<a class="headerlink" href="#public-permissioned-blockchain-network" title="Permalink to this headline">¶</a></h3>
<p>The system requires at least one <a class="reference external" href="https://github.com/hesusruiz/PublicPermissionedBlockchain">Public-Permissioned</a> blockchain network. The network should be trusted, efficient, publicly available and compliant with all applicable regulations.</p>
<p>The system is designed to be easily interoperable with other Public-Permissioned blockchain networks, like LACChain or EBSI. This is described in detail in the appropriate section of this document.</p>
</div>
<div class="section" id="information-in-the-blockchain-and-personal-identifiable-information-pii">
<h3><span class="section-number">1.3.2. </span>Information in the blockchain and Personal Identifiable Information (PII)<a class="headerlink" href="#information-in-the-blockchain-and-personal-identifiable-information-pii" title="Permalink to this headline">¶</a></h3>
<p><strong>No personal information is ever recorded on the blockchain</strong>. The blockchain is only used  to register the identities of the legal persons involved in the system. The information recorded for businesses and organizations includes:</p>
<ul class="simple">
<li><p>Public identification information of the legal person in the current regulatory environment, like VAT number, LEI (<a class="reference external" href="https://www.gleif.org">Legal Entity Identifier</a>), or any legally accepted identification in the countries implementing the the system.</p></li>
<li><p>Some commercial information, like the web site</p></li>
<li><p>The public key used to verify the Verifiable Credentials digitally signed by the legal entity</p></li>
</ul>
<p>The diagram below shows the registration of a new Issuer Entity in the blockchain. There are two types of legal persons registered in the blockchain:</p>
<ol class="arabic simple">
<li><p><strong>Issuer Entity</strong>: a legal person has to be properly registered before it can issue any credential that can be verified by other actors in the system.</p></li>
<li><p><strong>Verifier Entity</strong>: a legal person that receives and verifies credentials from natural persons has to be registered in the blockchain. When the legal person receives the credential (which includes personal data), this fact is registered in order to enhance auditability of the system later. This registration is performed in a privacy-preserving and scalable way. The process is described in detail later in this document. Natural persons can also verify credentials, but the verification process is different in order to avoid pre-registration of natural persons. This is described in detail later.</p></li>
</ol>
<div class="figure align-default" id="id5">
<a class="reference internal image-reference" href="_images/RapidTest_Architecture.png"><img alt="Trusted Registry of Legal Entities in the blockchain" src="_images/RapidTest_Architecture.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">Trusted Registry of Legal Entities in the blockchain.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="trust-framework-trusted-registration-process-of-legal-entities">
<h3><span class="section-number">1.3.3. </span>Trust Framework: trusted registration process of legal entities<a class="headerlink" href="#trust-framework-trusted-registration-process-of-legal-entities" title="Permalink to this headline">¶</a></h3>
<p>The trust framework is designed to be largely decentralised.</p>
<p>The identities of the legal persons involved in the ecosystem are registered in a common directory implemented in the blockchain following a hierarchical scheme very similar to the DNS (Domain Name Service) schema in the Internet. Once an entity is registered in the system, it is completely autonomous for adding other entities that are managed as child entities.</p>
<p>However, there is one centralised element: the root of trust at the top of the hierarchy should be a trusted entity in the ecosystem that is the one bootstraping the system. Typically it should be a regulatory body or a public administration.</p>
<p>The approach is described in the following figure.</p>
<div class="figure align-default" id="id6">
<a class="reference internal image-reference" href="_images/SafeIsland_TrustFramework.png"><img alt="The Trust Framework in the blockchain" src="_images/SafeIsland_TrustFramework.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">The Trust Framework in the blockchain.</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="creating-identities">
<h4><span class="section-number">1.3.3.1. </span>Creating identities<a class="headerlink" href="#creating-identities" title="Permalink to this headline">¶</a></h4>
<p>A new identity can only be registered as a sub-node by an existing entity already registered in the system. The API used is <code class="docutils literal notranslate"><span class="pre">/api/did/v1/identifiers</span></code> and its definition is the following:</p>
<dl class="http post">
<dt id="post--api-did-v1-identifiers">
<code class="sig-name descname"><span class="pre">POST</span> </code><code class="sig-name descname"><span class="pre">/api/did/v1/identifiers</span></code><a class="headerlink" href="#post--api-did-v1-identifiers" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an Identity anchored in the blockchain.</p>
<dl class="field-list simple">
<dt class="field-odd">Request JSON Object</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>DID</strong> (<em>string</em>) – the DID of the new identity, example: “did:elsi:VATES-B60645900”</p></li>
<li><p><strong>domain_name</strong> (<em>string</em>) – Domain name to assign in the hierarchy, example: “in2.ala”</p></li>
<li><p><strong>website</strong> (<em>string</em>) – Website of the entity, example: “www.in2.es”</p></li>
<li><p><strong>commercial_name</strong> (<em>string</em>) – Commercial name, example: “IN2 Innovating 2gether”</p></li>
<li><p><strong>new_privatekey</strong> (<em>PrivatekeyJWK</em>) – The private key of the new entity</p></li>
<li><p><strong>parent_privatekey</strong> (<em>PrivatekeyJWK</em>) – The Private Key of caller (in this case the owner of “ala”)</p></li>
</ul>
</dd>
</dl>
<p>An example of the data in the request body:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;DID&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
    <span class="nt">&quot;domain_name&quot;</span><span class="p">:</span> <span class="s2">&quot;in2.ala&quot;</span><span class="p">,</span>
    <span class="nt">&quot;website&quot;</span><span class="p">:</span> <span class="s2">&quot;www.in2.es&quot;</span><span class="p">,</span>
    <span class="nt">&quot;commercial_name&quot;</span><span class="p">:</span> <span class="s2">&quot;IN2 Innovating 2gether&quot;</span><span class="p">,</span>
    <span class="nt">&quot;new_privatekey&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
        <span class="nt">&quot;crv&quot;</span><span class="p">:</span> <span class="s2">&quot;secp256k1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;Dqv3jmu8VNMKXWrHkppr5473sLMzWBczRhzdSdpxDfI&quot;</span><span class="p">,</span>
        <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;FTiW0a4r7S2SwjL7AlFlN1yJNWF--4_x3XTTxkFbJ9o&quot;</span><span class="p">,</span>
        <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;MmpxbQCOZ0L9U6rLLkD_U8LRGwYEHcoN-DPnEdlpt6A&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;parent_privatekey&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
        <span class="nt">&quot;crv&quot;</span><span class="p">:</span> <span class="s2">&quot;secp256k1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;Dqv3jmu8VNMKXWrHkppr5473sLMzWBczRhzdSdpxDfI&quot;</span><span class="p">,</span>
        <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;NKW_0Fs4iumEegzKoOH0Trwtje1sXsG9Z1949sA8Omo&quot;</span><span class="p">,</span>
        <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;g4B3EI0qIdlcXTn-2RpUxgVX-sxNFdqCQDD0aHztVkk&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Response JSON Object</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>didDocument</strong> (<em>DIDDocument</em>) – The DID document associated to the input DID</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>A more detailed explanation of each field follows:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DID</span></code></dt><dd><p>is the DID of the new entity. We support ELSI DID method (ELSI_DID_Method) and AlastriaID. The DID has to be created before the call to the API with the appropriate method for the DID. In the case of ELSI this is trivial and described in the section mentioned above.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">domain_name</span></code></dt><dd><p>the domain name for the new entity in the Trust Framework. In the example it is <cite>in2.ala</cite> because it will be a sub-node of the Alastria one. The new identity will be created as a child node of the existing node owned by the entity controlling the <code class="docutils literal notranslate"><span class="pre">parent_privatekey</span></code>. If the parent domain name specified here is not owned by the entity controlling the <code class="docutils literal notranslate"><span class="pre">parent_privatekey</span></code>, an error is returned and no action is taken.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">website</span></code></dt><dd><p>the website address in the off-chain world, so other participants can look more information about the entity. This field is informational only. However, it can be used by external appications to check that the entity in th ereal world corresponds to the one registered in th eblockchain.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">commercial_name</span></code></dt><dd><p>the name of the company as it appears in the official register of the country/region. For example, in the case of IN2 (a Spanish business), the name should be the one registered in the <a class="reference external" href="http://www.rmc.es/Home.aspx?lang=en">Business Registry of Spain</a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">new_privatekey</span></code></dt><dd><p>is the Private Key of the new entity, in JWK format. In this case the new entity is IN2. Please make sure the server being called is highly trusted.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">parent_privatekey</span></code></dt><dd><p>is the Private Key of the entity owning/controlling the parent node in the domain name, in JWK format. In this case the parent node is <cite>ala</cite>, corresponding to Alastria. Please make sure the server being called is highly trusted. Ideally, the server has to be operated by the same entity calling the API.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="credential-flows">
<h2><span class="section-number">1.4. </span>Credential flows<a class="headerlink" href="#credential-flows" title="Permalink to this headline">¶</a></h2>
<div class="section" id="credential-issuance">
<h3><span class="section-number">1.4.1. </span>Credential Issuance<a class="headerlink" href="#credential-issuance" title="Permalink to this headline">¶</a></h3>
<p>The figure below describes the interaction flows between the Issuer and the Citizen. Here the term Issuer includes the mobile application of the Issuer Operator and the associated backend system of the Issuer Entity.</p>
<p>The main interaction consists on the transmission of the Verifiable Credential from the Issuer to the mobile of the Citizen. The transmission is initiated with a QR.</p>
<p>The flows and the APIs used are described in detail below.</p>
<div class="figure align-default" id="id7">
<a class="reference internal image-reference" href="_images/SafeIsland_CredentialIssuance.png"><img alt="Credential Issuance" src="_images/SafeIsland_CredentialIssuance.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text">Credential Issuance.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>The credential issuance process is the following:</p>
<p><strong>Credential generation</strong></p>
<ul class="simple">
<li><p>The diagram assumes that the Issuer Operator starts the process for th ecreation of the credential, but other initiation mechanisms could be used depending on the context.</p></li>
<li><p>The system gathers existing data from the citizen from a previous identification process, like KYC.</p></li>
<li><p>The system stores the information and generates a credential in the standard W3C Verifiable Credential format.</p></li>
<li><p>The system then generates and displays a QR code that will be scanned by the Citizen to receive the Credential. The QR contains the URL in the Issuer’s system where the credential can be retrieved.</p></li>
</ul>
<p><strong>Citizen receives the Credential</strong></p>
<ul class="simple">
<li><p>The Citizen uses the webapp to scan the QR code displayed by the Issuer Operator</p></li>
<li><p>The Citizen mobile webapp uses the URL in the QR to get the credential in JWT format, signed by the Issuer.</p></li>
</ul>
<p><strong>Citizen webapp verifies the credential and signature of Issuer</strong></p>
<ul class="simple">
<li><p>The credential is verified as per the standard <a class="reference external" href="https://w3c.github.io/vc-imp-guide">W3C Verifiable Credentials Implementation Guidelines</a>.</p></li>
<li><p>The verification includes resolving in the blockchain the identity of the Issuer Entity specified by the Issuer DID in the credential. The Issuer DID is registered in the blockchain and it includes the Public Key used by the Issuer Entity to digitally sign the credential.</p></li>
<li><p>The Citizen mobile webapp uses a Universal Resolver to make this DID resolution and access the blockchain in read mode. The Universal Resolver is described in detail later in this document.</p></li>
<li><p>After verification the credential is stored in the local storage of the Citizen mobile device. The user has also the option to store the credential in encrypted form in one or more of the personal cloud storage systems she has (Google Drive, MS Onedrive, Dorpbox, …).</p></li>
</ul>
</div>
<div class="section" id="credential-verification">
<h3><span class="section-number">1.4.2. </span>Credential Verification<a class="headerlink" href="#credential-verification" title="Permalink to this headline">¶</a></h3>
<p>The system supports the standard online verification process as is common in most implementations of an SSI system. But in addition it supports a special flow for on-person verification of credentials, for example when the credential has to be presented to a Verifier Operator in-person and it has to be verified by the Operator.
This flow is useful when some process has to be performed in-person in the offices of the Verifier Entity, or even when for some reason it has to be performed out of the offices. In other words, when the citizen is not interacting directly with a web page of the Verifier Entity.</p>
<p>This is the flow represented in the following diagram.</p>
<div class="figure align-default" id="id8">
<a class="reference internal image-reference" href="_images/SafeIsland_CredentialPresentation.png"><img alt="_images/SafeIsland_CredentialPresentation.png" src="_images/SafeIsland_CredentialPresentation.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text">Credential Verification</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="elsi-a-did-method-for-legal-entities">
<h2><span class="section-number">1.5. </span>ELSI: a DID Method for legal entities<a class="headerlink" href="#elsi-a-did-method-for-legal-entities" title="Permalink to this headline">¶</a></h2>
<p>The system supports several DID Methods using the Universal Resolver to resolve each DID into a corresponding DID Document.
But the main DID Method used for legal persons, anchored into a Public-Permissioned blockchain, is <em>ELSI</em>: <cite>did:elsi</cite>.</p>
<div class="section" id="elsi-did-syntax">
<h3><span class="section-number">1.5.1. </span>ELSI DID syntax<a class="headerlink" href="#elsi-did-syntax" title="Permalink to this headline">¶</a></h3>
<p>The name ELSI stands for <strong>E</strong>TSI <strong>L</strong>egal person <strong>S</strong>emantics <strong>I</strong>dentifier, because it is based on the <em>Legal person semantic identifier</em> defined in the <a class="reference external" href="https://www.etsi.org/deliver/etsi_en/319400_319499/31941201/01.04.02_20/en_31941201v010402a.pdf">European Norm ETSI EN 319 412-1</a>, related to digital signatures, peer entity authentication, data authentication as well as data confidentiality.</p>
<p>The ELSI DID Method refers only to legal persons, so we are using the <em>id-etsi-qcs-SemanticsId-Legal</em> definition described in Section 5.1 of ETSI EN 319 412-1.</p>
<p>Creating a DID is extremely simple and fully decentralized (does not require participation of any central authority), assuming that the legal person already exists. Its definition using ABNF syntax is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">did</span> <span class="o">=</span> <span class="s2">&quot;did:elsi:&quot;</span> <span class="nb">id</span><span class="o">-</span><span class="n">etsi</span><span class="o">-</span><span class="n">qcs</span><span class="o">-</span><span class="n">SemanticsId</span><span class="o">-</span><span class="n">Legal</span>
</pre></div>
</div>
<p>Which is the concatenation of the prefix <cite>did:elsi:</cite> with the legal person identifier defined in ETSI EN 319 412-1. For the full syntax, please refer to the standards document, but for the two most common basic identifiers (VAT and LEI) the identifier is composed of:</p>
<ul class="simple">
<li><p>3 character legal person identity type reference, like <cite>VAT</cite> for identification based on a national value added tax identification number or <cite>LEI</cite> for the <a class="reference external" href="https://www.gleif.org">Legal Entity Identifier</a>.</p></li>
<li><p>2 character ISO 3166 [2] country code;</p></li>
<li><p>hyphen-minus “-” (0x2D (ASCII), U+002D (UTF-8)); and</p></li>
<li><p>identifier (according to country and identity type reference).</p></li>
</ul>
<p>Some examples of DIDs are the following:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 54%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>DID</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ENDESA ENERGÍA (www.endesa.com)</p></td>
<td><p><strong>did:elsi:VATES-A81948077</strong></p></td>
</tr>
<tr class="row-odd"><td><p>IN2 (www.ins.es)</p></td>
<td><p><strong>did:elsi:VATES-B60645900</strong></p></td>
</tr>
<tr class="row-even"><td><p>AENA (www.aena.es)</p></td>
<td><p><strong>did:elsi:VATES-A86212420</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Inter-American Development Bank (www.iadb.org)</p></td>
<td><p><strong>did:elsi:LEIXG-VKU1UKDS9E7LYLMACP54</strong></p></td>
</tr>
<tr class="row-even"><td><p>DAA plc (Dublin Airport Authority) (www.daa.ie)</p></td>
<td><p><strong>did:elsi:LEIXG-635400HRFGVKXFHZ8O77</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="elsi-did-document">
<h3><span class="section-number">1.5.2. </span>ELSI DID Document<a class="headerlink" href="#elsi-did-document" title="Permalink to this headline">¶</a></h3>
<p>An example DID Document is the following:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="nt">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;@context&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;https://www.w3.org/ns/did/v1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://w3id.org/security/v1&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
    <span class="nt">&quot;verificationMethod&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#key-verification&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;JwsVerificationKey2020&quot;</span><span class="p">,</span>
        <span class="nt">&quot;controller&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
        <span class="nt">&quot;publicKeyJwk&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;kid&quot;</span><span class="p">:</span> <span class="s2">&quot;key-verification&quot;</span><span class="p">,</span>
        <span class="nt">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
        <span class="nt">&quot;crv&quot;</span><span class="p">:</span> <span class="s2">&quot;secp256k1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;3K4iNuzPkcrHlEbhHE8vYXlF6K5xGZ2rdOrn3cQ-LnQ&quot;</span><span class="p">,</span>
        <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;9Z_l_hQLkq6aLuZz8gheq7R_o5ZUHUlxZ3IBGHsdzaA&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#info&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EntityCommercialInfo&quot;</span><span class="p">,</span>
        <span class="nt">&quot;serviceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;www.in2.es&quot;</span><span class="p">,</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;IN2 Innovating 2gether&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#sms&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SecureMessagingService&quot;</span><span class="p">,</span>
        <span class="nt">&quot;serviceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://privatecred.hesusruiz.org/api&quot;</span>
    <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;anchors&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;redt.alastria&quot;</span><span class="p">,</span>
        <span class="nt">&quot;resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;UniversalResolver&quot;</span><span class="p">,</span>
        <span class="nt">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;in2.ala&quot;</span><span class="p">,</span>
        <span class="nt">&quot;ethereumAddress&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8CDA8113567e633805e48c87747257E9FFAAdDF5&quot;</span>
    <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-02-08T06:53:08Z&quot;</span><span class="p">,</span>
    <span class="nt">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-02-08T06:53:08Z&quot;</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="privacycred-verifiable-credentials">
<h2><span class="section-number">1.6. </span>PrivacyCred Verifiable Credentials<a class="headerlink" href="#privacycred-verifiable-credentials" title="Permalink to this headline">¶</a></h2>
<div class="section" id="data-model">
<h3><span class="section-number">1.6.1. </span>Data Model<a class="headerlink" href="#data-model" title="Permalink to this headline">¶</a></h3>
<p>The PrivacyCred credential uses the standard <a class="reference external" href="https://www.w3.org/TR/vc-data-model">W3C Verifiable Credentials Data Model</a> for its representation, with some extensions to fit the requirements of this use case.</p>
<p>The specific credential data is encoded in the credentialSubject field of the VC. The following two figures represent the complete VC, where it has been divided in two parts to facilitate visualization.</p>
<div class="figure align-default" id="id9">
<a class="reference internal image-reference" href="_images/SafeIsland_VCSample.png"><img alt="_images/SafeIsland_VCSample.png" src="_images/SafeIsland_VCSample.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text">W3C Verifiable Credential and extensions</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<p>The figure above represents the VC with standard fields and some extensions.</p>
<ol class="arabic">
<li><p>The iss field (issuer in VC terminology), uses the DID method <code class="docutils literal notranslate"><span class="pre">elsi</span></code>, specific for legal persons and explained in a section below.</p></li>
<li><p>There is an extension to specify the blockchain network (or networks) where the VC can be verified. More precisely, the <code class="docutils literal notranslate"><span class="pre">issuedAt</span></code> field of <code class="docutils literal notranslate"><span class="pre">credentialSubject</span></code> specifies the networks where the identity for the legal person that issued the credential can be verified.</p>
<p>A legal person can have its <cite>elsi</cite> DID registered in one or more networks, and the same credential can be verified using any of those networks. The trust on the credential depends on the trust on the registration procedure of the identity of the signer. The Verifier entity can choose to verify the credential in whatever network is trusted to the Verifier.</p>
<p>This mechanism provides a lot of flexibility in interoperability schemes across networks. More details are described in the section on interoperability.</p>
</li>
</ol>
</div>
<div class="section" id="example-of-verifiable-credential">
<h3><span class="section-number">1.6.2. </span>Example of Verifiable Credential<a class="headerlink" href="#example-of-verifiable-credential" title="Permalink to this headline">¶</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;exp&quot;</span><span class="p">:</span> <span class="mi">1614770844</span><span class="p">,</span>
    <span class="nt">&quot;iat&quot;</span><span class="p">:</span> <span class="mi">1614252444</span><span class="p">,</span>
    <span class="nt">&quot;iss&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-X12345678X&quot;</span><span class="p">,</span>
    <span class="nt">&quot;sub&quot;</span><span class="p">:</span> <span class="s2">&quot;46106508H&quot;</span><span class="p">,</span>
    <span class="nt">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;829588b3162249d28f3eae5e84349777&quot;</span><span class="p">,</span>
    <span class="nt">&quot;vc&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;@context&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;https://www.w3.org/2018/credentials/v1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;https://alastria.github.io/identity/credentials/v1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;https://privacycred.org/.well-known/privacycred/v1&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;VerifiableCredential&quot;</span><span class="p">,</span>
                <span class="s2">&quot;AlastriaVerifiableCredential&quot;</span><span class="p">,</span>
                <span class="s2">&quot;PrivacyCredential&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;credentialSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivacyCredential&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;JsonSchemaValidator2018&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;credentialSubject&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;privacyCredential&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;citizen&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;dob&quot;</span><span class="p">:</span> <span class="s2">&quot;27-04-1982&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;idnumber&quot;</span><span class="p">:</span> <span class="s2">&quot;46106508H&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;COSTA/ALBERTO&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;atRisk&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;comments&quot;</span><span class="p">:</span> <span class="s2">&quot;These are some comments&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="nt">&quot;issuedAt&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;redt.alastria&quot;</span>
                <span class="p">],</span>
                <span class="nt">&quot;levelOfAssurance&quot;</span><span class="p">:</span> <span class="mi">2</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="verification-of-the-credentials">
<h2><span class="section-number">1.7. </span>Verification of the credentials<a class="headerlink" href="#verification-of-the-credentials" title="Permalink to this headline">¶</a></h2>
<p>The system includes two APIs to help client applications with the verification of credentials received from other actors in the ecosystem. The choice of API depends on the trust level of the client application on the server implementing the APIs</p>
<dl class="http get">
<dt id="get--api-did-v1-identifiers-(string-DID)">
<code class="sig-name descname"><span class="pre">GET</span> </code><code class="sig-name descname"><span class="pre">/api/did/v1/identifiers/</span></code><span class="sig-paren">(</span><em class="property"><span class="pre">string:</span> </em><em class="sig-param"><span class="pre">DID</span></em><span class="sig-paren">)</span><a class="headerlink" href="#get--api-did-v1-identifiers-(string-DID)" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolves a DID and returns the DID Document (JSON format), if it exists.
It supports four DID methods: <strong>ebsi</strong>, <strong>elsi</strong>, <strong>ala</strong>, <strong>peer</strong>.</p>
<p>Only <strong>PEER</strong> and <strong>ELSI</strong> (<em>https://github.com/hesusruiz/SafeIsland#62-elsi-a-novel-did-method-for-legal-entities</em>) are directly implemented by this API.
The others are delegated to be resolved by their respective implementations.</p>
<p>For example, for <strong>EBSI</strong> we call the corresponding Universal Resolver API, currently in testing and available at
<a class="reference external" href="https://api.ebsi.xyz/did/v1/identifiers">https://api.ebsi.xyz/did/v1/identifiers</a>/{did}</p>
<dl class="field-list simple">
<dt class="field-odd">Query Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>DID</strong> (<em>string</em>) – The DID to resolve into a DID Document.</p></li>
</ul>
</dd>
<dt class="field-even">Response JSON Object</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>didDocument</strong> (<em>payload</em>) – The DID document associated to the input DID</p></li>
</ul>
</dd>
<dt class="field-odd">Status Codes</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.2.1">200 OK</a> – no error</p></li>
<li><p><a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.5">404 Not Found</a> – error resolving the DID</p></li>
</ul>
</dd>
</dl>
<p><strong>Example request</strong>:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/api/did/v1/identifiers/did:elsi:VATES-B60645900</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">example.com</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>
</div>
<p><strong>Example response</strong>:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Vary</span><span class="o">:</span> <span class="l">Accept</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/javascript</span>

<span class="p">{</span>
    <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;@context&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;https://www.w3.org/ns/did/v1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://w3id.org/security/v1&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
        <span class="s2">&quot;verificationMethod&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#key-verification&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;JwsVerificationKey2020&quot;</span><span class="p">,</span>
                <span class="s2">&quot;controller&quot;</span><span class="o">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
                <span class="s2">&quot;publicKeyJwk&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;kid&quot;</span><span class="o">:</span> <span class="s2">&quot;key-verification&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;kty&quot;</span><span class="o">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;crv&quot;</span><span class="o">:</span> <span class="s2">&quot;secp256k1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;x&quot;</span><span class="o">:</span> <span class="s2">&quot;3K4iNuzPkcrHlEbhHE8vYXlF6K5xGZ2rdOrn3cQ-LnQ&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;y&quot;</span><span class="o">:</span> <span class="s2">&quot;9Z_l_hQLkq6aLuZz8gheq7R_o5ZUHUlxZ3IBGHsdzaA&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;service&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#info&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;EntityCommercialInfo&quot;</span><span class="p">,</span>
                <span class="s2">&quot;serviceEndpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;www.in2.es&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;IN2 Innovating 2gether&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#sms&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;SecureMessagingService&quot;</span><span class="p">,</span>
                <span class="s2">&quot;serviceEndpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://privatecred.hesusruiz.org/api&quot;</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;anchors&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;redt.alastria&quot;</span><span class="p">,</span>
                <span class="s2">&quot;resolution&quot;</span><span class="o">:</span> <span class="s2">&quot;UniversalResolver&quot;</span><span class="p">,</span>
                <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="s2">&quot;in2.ala&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ethereumAddress&quot;</span><span class="o">:</span> <span class="s2">&quot;0x8CDA8113567e633805e48c87747257E9FFAAdDF5&quot;</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;created&quot;</span><span class="o">:</span> <span class="s2">&quot;2021-02-08T06:53:08Z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;updated&quot;</span><span class="o">:</span> <span class="s2">&quot;2021-02-08T06:53:08Z&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<p>In general, validating a credential involves the following:</p>
<ol class="arabic simple">
<li><p>Deserialize the JWT without verifying it (we do not yet have the public key).</p></li>
<li><p>Get the <code class="docutils literal notranslate"><span class="pre">kid</span></code> property from the header (the JOSE header of the JWT).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">kid</span></code> has the format did#id where <code class="docutils literal notranslate"><span class="pre">did</span></code> is the DID of the issuer and <code class="docutils literal notranslate"><span class="pre">id</span></code> is the identifier of the key in the DIDDocument associated to the DID.</p></li>
<li><p>Perform resolution of the DID of the issuer with the Universal Resolver API.</p></li>
<li><p>Get the public key specified inside the DIDDocument.</p></li>
<li><p>Verify the JWT using the public key associated to the DID.</p></li>
<li><p>Verify that the DID in the <code class="docutils literal notranslate"><span class="pre">iss</span></code> field of the JWT payload is the same as the one that signed the JWT.</p></li>
</ol>
<dl class="http post">
<dt id="post--api-verifiable-credential-v1-verifiable-credential-validations">
<code class="sig-name descname"><span class="pre">POST</span> </code><code class="sig-name descname"><span class="pre">/api/verifiable-credential/v1/verifiable-credential-validations</span></code><a class="headerlink" href="#post--api-verifiable-credential-v1-verifiable-credential-validations" title="Permalink to this definition">¶</a></dt>
<dd><p>Is the easiest one to use and the one requiring higher level of trust. The client app just passes the JWT in the JWS Compact Serialization format (RFC 7519) as the body of a POST request and the server verifies the credential and credential signature using internally the Universal Resolver API for resolving the DID of the Issuer and checking its digital signature.</p>
<dl class="field-list simple">
<dt class="field-odd">Request JSON Object</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>credential</strong> (<em>JWT</em>) – The credential in JWT format.</p></li>
</ul>
</dd>
<dt class="field-even">Response JSON Object</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>claims</strong> (<em>object</em>) – The JSON object with the verified claims in the JWT. Otherwise, an error</p></li>
</ul>
</dd>
<dt class="field-odd">Status Codes</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.2.1">200 OK</a> – no error</p></li>
<li><p><a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.5">404 Not Found</a> – error resolving the DID</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>The easiest one to use is <a class="reference internal" href="#post--api-verifiable-credential-v1-verifiable-credential-validations" title="POST /api/verifiable-credential/v1/verifiable-credential-validations"><code class="xref http http-post docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/verifiable-credential/v1/verifiable-credential-validations</span></code></a> and it is the one requiring higher level of trust. The client app just passes the JWT in the JWS Compact Serialization format (RFC 7519) as the body of a POST request and the server verifies the credential and credential signature using internally the Universal Resolver API for resolving the DID of the Issuer and checking its digital signature.</p>
<p><a class="reference internal" href="#get--api-did-v1-identifiers-(string-DID)" title="GET /api/did/v1/identifiers/(string:DID)"><code class="xref http http-get docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/api/did/v1/identifiers/(string:DID)</span></code></a> is the Universal Resolver API. The client application will have to perform the validations that the server does in the previous call.</p>
</div>
</div>
<div class="section" id="privacyconsent-description">
<h1><span class="section-number">2. </span>PrivacyConsent description<a class="headerlink" href="#privacyconsent-description" title="Permalink to this headline">¶</a></h1>
<p>Once the PrivacyCred system is operating and the relevant legal entities are registered in the Trust Framework, the management of PrivacyConsent credentials is relatively easy, as it can be implemented using otherwise standard credentials using the underlying PrivateCred system, and benefiting from its specific privacy characteristics.</p>
<div class="section" id="credential-issuance-by-first-entity">
<h2><span class="section-number">2.1. </span>Credential issuance by first entity<a class="headerlink" href="#credential-issuance-by-first-entity" title="Permalink to this headline">¶</a></h2>
<p>The flow of issuance of a PrivacyConsent credential is mostly the same as any other credential. However, it includes some special items. The overall flow is:</p>
<ul class="simple">
<li><p>The citizen logs into the system of the Issuer Entity. If the entity is a private company, we assume that the citizen is already an existing customer and that the proper KYC processes have benn performed when the customer was onboarded. This process can also be performed over the phone if the business has a proper mechanism of identifying the customer in order to perform legaly binding transactions. If the entity is a public administration, we assume that the entity performs the identification with the nationally acceptable mecanisms, including in-person and remote mechanisms.</p></li>
<li><p>The citizen explicitly accepts to provide consent for a given purpose. The operation should be performed in the same way as if the customer were executing other legaly binding operations in the Issuer Entity system. This is acting effectively as a signature of the fact that the citizen is providing consent for a given purpose.</p></li>
<li><p>The Issuer Entity records the consent for future reference, as it is done currently without verifiable credentials.</p></li>
<li><p>The Issuer Entity generates a Verifiable Credential that includes the explicit consent and purpose, and the citizen Peer DID. The credential is digitally signed by the Issuer Entity with the private key associated to the public key registered in the Trust Framework. Including the Peer DID of the citizen, the credential is binding that Peer DID with the real identity of the citizen (as verified using the KYC data). And this binding is digitally signed by the Issuer Entity in a tamper-resistant way.</p></li>
<li><p>The citizen receives the credential via the QR mechanism (or any other that is supported by the system).</p></li>
</ul>
<p>After the interaction, both parties (citizen and Issuer Entity) have a digital representation of the informed consent:</p>
<ul class="simple">
<li><p>The Issuer Entity has a consent with a proof of citizen acceptance based on the KYC process that was performed when onboarding the citizen.</p></li>
<li><p>The citizen has a credential digitally signed by the Issuer Entity attesting that the citizen provided consent and that it was accepted by the Issuer Entity.</p></li>
</ul>
<div class="figure align-default" id="id10">
<a class="reference internal image-reference" href="_images/PrivacyConsent_Issuance.png"><img alt="_images/PrivacyConsent_Issuance.png" src="_images/PrivacyConsent_Issuance.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text">Issuance of a PrivacyConsent credential</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="credential-reception-by-second-entity">
<h2><span class="section-number">2.2. </span>Credential reception by second entity<a class="headerlink" href="#credential-reception-by-second-entity" title="Permalink to this headline">¶</a></h2>
<p>After the previous process, the first entity has already the consent from the citizen. The process to send the consent to the second participating entity is based on the verification flows. The process is the following:</p>
<p>The citizen interacts with the Verifier Entity. This could be done via different channels, like login into the system of the Verifier Entity, or in-person in the premises of the entity. It can also be performed via other electronic channels like email or even messaging systems. Here we describe the process for in-person interaction as when the citizen goes to the social services for the first time and she does not have yet any legally accepted identification mechanism to interact with the public administration. After the first interaction, all other interactions could be performed remotely.</p>
<p>The citizen uses her mobile app to generate a W3C Presentation object, which is essentially a digitally signed object including one or more credentials. The Presentation object is digitally signed with the private key associated to the Peer DID that was used when the process of generating the credential was performed by the first entity.</p>
<p>In this way, the Presentation object includes the following:</p>
<ul class="simple">
<li><p>The purpose of the consent.</p></li>
<li><p>The proof that the Issuer Entity is attesting that it received the explicit consent from the customer, after identifying her.</p></li>
<li><p>The signature of the whole thing using a private key associated to the Peer DID that the citizen provided to the Issuer Entity.</p></li>
</ul>
<div class="figure align-default" id="id11">
<a class="reference internal image-reference" href="_images/PrivacyConsent_Presentation.png"><img alt="_images/PrivacyConsent_Presentation.png" src="_images/PrivacyConsent_Presentation.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text">Acceptance of a PrivacyConsent credential by a second entity</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PrivacyCred</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. PrivacyCred description</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">1.1. Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#privacycred-general-description-of-the-system">1.2. PrivacyCred: General description of the system</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-trust-framework-bootstrapping-the-system">1.3. The Trust Framework: bootstrapping the system</a></li>
<li class="toctree-l2"><a class="reference internal" href="#credential-flows">1.4. Credential flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#elsi-a-did-method-for-legal-entities">1.5. ELSI: a DID Method for legal entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#privacycred-verifiable-credentials">1.6. PrivacyCred Verifiable Credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="#verification-of-the-credentials">1.7. Verification of the credentials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#privacyconsent-description">2. PrivacyConsent description</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#credential-issuance-by-first-entity">2.1. Credential issuance by first entity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#credential-reception-by-second-entity">2.2. Credential reception by second entity</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to PrivacyCred’s documentation!</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Jesus Ruiz.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/privacycred.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>